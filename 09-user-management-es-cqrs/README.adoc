= CQRS and Event sourcing on Spring Cloud Stream image:https://travis-ci.org/daggerok/spring-examples.svg?branch=master["Build Status", link="https://travis-ci.org/daggerok/spring-examples"]

//tag::content[]

_Spring Cloud Stream | CQRS and Event Sourcing_

[source,bash]
----
bash gradlew clean build
bash gradlew bootRun
----

.create user command
[source,bash]
----
http post :8080/

[
    {
        "href": "http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d",
        "rel": "self"
    },
    {
        "href": "http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d/activate",
        "rel": "activate"
    },
    {
        "href": "http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d/replay",
        "rel": "replay"
    }
]
----

.get user query
[source,bash]
----
http http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d

{
    "activated": false,
    "changes": [
        {
            "id": "88f2829a-a1e7-4655-8d4d-83c812ab9a2d"
        }
    ],
    "deactivated": false,
    "id": "88f2829a-a1e7-4655-8d4d-83c812ab9a2d",
    "nickname": "anonymous",
    "state": "INITIALIZED"
}
----

.activate user command
[source,bash]
----
http post http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d/activate
# ...
----

.replay user events query
----
http http http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d/replay

[
    {
        "UserInitializedEvent": {
            "id": "88f2829a-a1e7-4655-8d4d-83c812ab9a2d"
        }
    },
    {
        "UserActivatedEvent": {}
    }
]
----

.get user again
[source,bash]
----
http http://localhost:8080/88f2829a-a1e7-4655-8d4d-83c812ab9a2d

{
    "activated": true,
    "changes": [
        {
            "id": "88f2829a-a1e7-4655-8d4d-83c812ab9a2d"
        },
        {}
    ],
    "deactivated": false,
    "id": "88f2829a-a1e7-4655-8d4d-83c812ab9a2d",
    "nickname": "anonymous",
    "state": "ACTIVATED"
}
----

resources:

. link:https://www.youtube.com/watch?v=LvmPa7YKgqM[CQRS and Event Sourcing with Spring Cloud Stream talk]
. link:https://docs.spring.io/spring-hateoas/docs/current/reference/html/[Spring HATEAOS]

//end::content02[]
